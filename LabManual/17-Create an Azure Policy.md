---
wts:
    title: '17 - Azure Policy の作成 (10 分)'
    module: 'モジュール 05: ID、ガバナンス、プライバシー、およびコンプライアンス機能に関する説明'
---
# 17 - Azure Policy の作成 (10 分)

このチュートリアルでは、Azure リソースのデプロイを特定の場所に制限する Azure Policy を作成します。

# タスク 1: ポリシー割り当てを作成する 

このタスクでは、許可されている場所のポリシーを構成し、サブスクリプションに割り当てます。 

1. Azure portal　([https://portal.azure.com](https://portal.azure.com))にサインインします。

2. Azure portalで、「**ポリシー**」を検索して選択し、「**作成**」セクションで「**定義**」をクリックします。  組み込みのポリシー定義の一覧を確認します。たとえば、「**カテゴリ**」ドロップダウンリストで「**Compute**」のみを選択します。「**許可された仮想マシン サイズ SKU**」定義により、自分の組織がデプロイできる仮想マシン SKU のセットを指定できます。

3. 「**ポリシー**」ブレードに戻り、「**作成**」 セクションの「**割り当て**」をクリックします。特定のスコープ内でポリシーが実行されるように割り当てられます。たとえば、サブスクリプションをスコープとして定義を割り当てることができます。 

4. 「**ポリシー | 割り当て**」 ブレードの上部の「**ポリシーの割り当て**」をクリックします。

5. 「**ポリシーの割り当て**」ブレードで、以下の内容を設定します。

      | 設定 | 値 |
    | --- | --- |
    | スコープ| **Azure Pass - スポンサープラン** |
    | ポリシー定義 | **許可されている場所** |
    | 割り当て名 | **許可されている場所** |
    
6. 「**次へ**」をクリックし、「**パラメーター**」タブで、「**許可されている場所**」で「**Japan West**」を選択します。「**確認および作成**」をクリックし、「**作成**」をクリックします。

    **注**: スコープによって、ポリシーの割り当てが適用されるリソース、またはリソースのグループが決まります。ポリシーはリソース グループ、またはサブスクリプション レベルで割り当てることができます。スコープの構成によって、リソースを除外させることもできます。

    **注**: この「**許可されている場所**」ポリシー定義では、すべてのリソースがデプロイされる場所を指定します。別の場所が選択されている場合、デプロイは許可されません。詳細については、[Azure Policy Samples](https://docs.microsoft.com/ja-jp/azure/governance/policy/samples/index) ページをご覧ください。

9. 「**許可されている場所**」ポリシーが「**ポリシー | 割り当て**」ブレードの一覧に表示されます。指定したスコープ レベル (サブスクリプション レベル) でポリシーが適用されます。

# タスク 2: 許可されている場所のポリシーをテストする

このタスクでは、許可されている場所のポリシーをテストします。 

1. Azure Portal で、**「ストレージ アカウント」** を検索して選択し、**「+ 作成」** をクリックします。

2. ストレージ アカウントを構成します。その他は既定値のままにします。 

    | 設定 | 値 |
    | --- | --- |
    | サブスクリプション | **Azure Pass - スポンサープラン** |
    | リソース グループ（新規作成） | **AzureStudent##** |
    | ストレージ アカウント名 | **storageaccount##$$$$** |
    | 地域 | **(US) East US** |

    注：##は受講番号を、$$$$は本日の月日を入力します。 (例：受講番号01、9月30日の場合→eduwebapps010930)

    

3. 「**確認および作成**」 をクリックしてから 「**作成**」 をクリックします。 

4. 「**許可されている場所**」ポリシー名を含む、リソースがポリシーにより許可されないことを示す**デプロイ失敗**エラーが表示されます。

# タスク 3: ポリシーの割り当てを削除する

このタスクでは、許可されている場所のポリシーの割り当てを削除してテストします。 

ポリシーの割り当てを削除して、今後の作業がブロックされないようにします。

1. Azure portalで「**ポリシー**」 を検索して選択し、「**許可されている場所**」 ポリシーをクリックします。

    **注**: 「**ポリシー**」 ブレードで、割り当てたさまざまなポリシーのコンプライアンス状態を表示することができます。

    **注**: 「許可されている場所」ポリシーに、正しくないリソースが表示される場合があります。それらはポリシーを割り当てる前に作成されたリソースです。

2. 「**許可されている場所**」をクリックします。「許可されている場所 ポリシーへの準拠」ブレードが開きます。

3. 上部メニューから「**割り当ての削除**」をクリックします。「**はい**」をクリックして、ポリシー割り当てを削除します。

4. タスク2と同様の手順でストレージ アカウントを作成して、ポリシーが無効になっていることを確認してください。

    **注**: 「**許可されている場所**」 ポリシーが役立つ一般的なシナリオには以下のようなものがあります: 
    - *コスト トラッキング*: リージョンの場所ごとに、サブスクリプションが異なる場合があります。このポリシーにより、すべてのリソースが対象のリージョンにデプロイされるようにし、コスト トラッキングを行うことができます。 
    - *データ常駐とセキュリティ コンプライアンス*: データ常駐要件を設定し、顧客ごとまたは特定のワークロードごとにサブスクリプションを作成し、すべてのリソースを特定のデータセンターにデプロイしてデータとセキュリティのコンプライアンス要件を確保することを定義することもできます。

Azure リソースの展開を特定のデータセンターに制限する Azure Policy を作成しました。
